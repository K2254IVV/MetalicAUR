pkgname=sublime-text-4
pkgver=4169
pkgrel=1
pkgdesc="Sublime Text 4 - Sophisticated text editor for code, markup and prose"
arch=('x86_64')
url="https://www.sublimetext.com/"
license=('custom')
depends=('gtk3' 'libpng' 'glib2' 'libx11' 'nss' 'at-spi2-atk' 'libcups' 'libdrm' 'mesa' 'gcc-libs' 'libxcb' 'libxkbcommon' 'wayland')
conflicts=('sublime-text' 'sublime-text-dev')
source=("https://download.sublimetext.com/sublimehq-pub.gpg"
        "sublime-text.repo")
sha256sums=('SKIP' 'SKIP')

prepare() {
  # Импорт GPG ключа
  cp sublimehq-pub.gpg "${srcdir}/"
}

package() {
  # Установка репозитория
  install -Dm644 sublime-text.repo "${pkgdir}/etc/pacman.d/sublime-text.repo"

  # Импорт GPG ключа
  install -Dm644 sublimehq-pub.gpg "${pkgdir}/usr/share/sublime-text/sublimehq-pub.gpg"

  # Создание скрипта установки
  install -Dm755 /dev/stdin "${pkgdir}/usr/bin/sublime-text-setup" <<EOF
#!/bin/bash
# Импорт GPG ключа
pacman-key --add /usr/share/sublime-text/sublimehq-pub.gpg
pacman-key --lsign-key 8A8F901A

# Обновление и установка
pacman -Syu --noconfirm sublime-text
EOF

  chmod +x "${pkgdir}/usr/bin/sublime-text-setup"
}
